---
title:  'A kinetic response model for standardized regression analyses of inflammation-triggered body temperature-time courses in mice: R-Code'
author: Hans H. Diebner, Ruhr-Universität Bochum
date: "Nov 05, 2020"
tags: [kinetic response model, mathematical modeling, systems biology, caspase-1 signaling, inflammation, LPS shock]
abstract: |
  This R-source code has been used for nonlinear regression analysis in the manuscript 'A kinetic response model for standardized regression analyses of inflammation-triggered body temperature-time courses in mice' by Hans H. Diebner, Sören Reinke, Angela Rösen-Wolff, and Stefan Winkler. The same method has earlier been applied for the analysis published in 'Non-canonical Caspase-1 signaling drives RIP2 dependent and TNF-alpha mediated inflammation in vivo' by Sören Reinke et al., Cell Reports 2020
output: 
    pdf_document:
        template: NULL
editor_options: 
  chunk_output_type: console
---

# Load libs and define the ODEs

```{r load_libs, echo=FALSE}
require(gdata)
require(Rmisc)
require(drc)
require(deSolve)
require(DescTools)
require(growthcurver)
require(pwr)
require(ggplot2)

#########################################################################################################
## ODE-models and functions to be transferred to drm (drc-package)
#########################################################################################################

temperatureODE <- function (t, y, parms) {
  dy = 0*y
  dy = parms[2]*y*(1.0-(y/parms[1])) - parms[4]*dgamma(t,shape=1,rate=parms[3])*y
  list(dy)
}
temperatureODE_gamma <- function (t, y, parms) {
  dy = 0*y
  dy = parms[2]*y*(1.0-(y/parms[1])) - parms[4]*dgamma(t,shape=2,rate=parms[3])*y
  list(dy)
}
temperatureODE_gamma_shape3 <- function (t, y, parms) {
  dy = 0*y
  dy = parms[2]*y*(1.0-(y/parms[1])) - parms[4]*dgamma(t,shape=3,rate=parms[3])*y
  list(dy)
}
temperatureODE_gamma_shape4 <- function (t, y, parms) {
  dy = 0*y
  dy = parms[2]*y*(1.0-(y/parms[1])) - parms[4]*dgamma(t,shape=4,rate=parms[3])*y
  list(dy)
}
temperatureODE_logistic <- function (t, y, parms) {
  dy = 0*y
  dy = parms[2]*y*(1.0-(y/parms[1]))
  list(dy)
}
temperatureModel <- function(x,parm){
  C <- parm[,1]
  r <- parm[,2]
  k <- parm[,3]
  p <- parm[,4]
  LL= NULL
  for(i in 1:length(parm[,1])){
    param=c(as.numeric(parm[i,1]),as.numeric(parm[i,2]),as.numeric(parm[i,3]),as.numeric(parm[i,4]))
    output <- ode(y = as.numeric(parm[i,1]), func = temperatureODE, times = c(0,as.numeric(x[i]),50), parms = param)
    LL <- rbind(LL, output[2,2])
  }
  return(log(LL))
}
temperatureModel_gamma <- function(x,parm){
  C <- parm[,1]
  r <- parm[,2]
  k <- parm[,3]
  p <- parm[,4]
  LL= NULL
  for(i in 1:length(parm[,1])){
    param=c(as.numeric(parm[i,1]),as.numeric(parm[i,2]),as.numeric(parm[i,3]),as.numeric(parm[i,4]))
    output <- ode(y = as.numeric(parm[i,1]), func = temperatureODE_gamma, times = c(0,as.numeric(x[i]),50), parms = param)
    LL <- rbind(LL, output[2,2])
  }
  return(log(LL))
}
temperatureModel_gamma_shape3 <- function(x,parm){
  C <- parm[,1]
  r <- parm[,2]
  k <- parm[,3]
  p <- parm[,4]
  LL= NULL
  for(i in 1:length(parm[,1])){
    param=c(as.numeric(parm[i,1]),as.numeric(parm[i,2]),as.numeric(parm[i,3]),as.numeric(parm[i,4]))
    output <- ode(y = as.numeric(parm[i,1]), func = temperatureODE_gamma_shape3, times = c(0,as.numeric(x[i]),50), parms = param)
    LL <- rbind(LL, output[2,2])
  }
  return(log(LL))
}
temperatureModel_gamma_shape4 <- function(x,parm){
  C <- parm[,1]
  r <- parm[,2]
  k <- parm[,3]
  p <- parm[,4]
  LL= NULL
  for(i in 1:length(parm[,1])){
    param=c(as.numeric(parm[i,1]),as.numeric(parm[i,2]),as.numeric(parm[i,3]),as.numeric(parm[i,4]))
    output <- ode(y = as.numeric(parm[i,1]), func = temperatureODE_gamma_shape4, times = c(0,as.numeric(x[i]),50), parms = param)
    LL <- rbind(LL, output[2,2])
  }
  return(log(LL))
}
var.pooled <- function(df1,df2,SD1,SD2){
  (df1*SD1^2 + df2*SD2^2)/(df1+df2)
}
SE.diff <- function(var.pool, n1,n2){
  sqrt(var.pool*(1/n1 + 1/n2))
}
```

# Illustration of the model behaviour - corresponds to Fig 1 of the publication

```{r Illustration, echo=FALSE, fig.height = 6, fig.width = 12}
#cairo_pdf("Fig1.pdf", height=6, width=12)
par(mfrow=c(1,2), mar=c(5, 5, 4, 2) + 0.1)

## Full dynamical system
func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=0.4
p=0.25
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
plot(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(28,38), col=1, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)
mtext("A)", line = 1, adj=0, cex=1.4)

## Only the damage function 
func<-temperatureODE_gamma_shape3
parms<-c(k,p)
parms<-c(C,0,k,p)
initial<-C
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=2, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

## Only the temperature auto-regulation
func<-temperatureODE_logistic
parms<-c(C,r)
func<-temperatureODE_gamma_shape3
parms<-c(C,r,k,0)
initial<-31.45
output <- ode(y = initial, func = func, times = seq(13.5,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=4, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)
#points(13.5,31.45, pch=19, col=2)

legend("topright", legend=c(expression(paste("full dynamics")),
                               expression(paste("only damage dynamics")),
                               expression(paste("only temperature auto-regulation"))),
                              lty=c(1,1,1), col=c(1,2,4), lwd=2)
##################################################

func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=0.4
p=0.25
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
plot(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(28,38), col=1, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)
mtext("B)", line = 1, adj=0, cex=1.4)

func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=1.2
p=0.25
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=3, lty=2, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=0.2
p=0.25
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=3, lty=3, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

points(13.5,31.45, pch=19, col=2)
abline(h=31.45, col=2, lty=3)
arrows(13.5,31.45,23,32.5, col=3,length=0.2,angle=20, code=2, lwd=2)
arrows(13.5,31.45, 5.5,30.3, col=3,length=0.2,angle=20, code=2, lwd=2)
mtext(expression(T[min]),side=4,at=31.45,line=0.5,cex=1.2)

func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=0.4
p=0.35
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=2, lty=2, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

func<-temperatureODE_gamma_shape3
C=37.5
r=0.04
k=0.4
p=0.15
parms<-c(C,r,k,p)
initial<-37.5
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=2, lty=3, xlab="Time t [h]", ylab="Temperature T(t) [C°]", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

points(13.5,31.45, pch=19, col=2)
abline(v=13.5, lty=3, col=2)
arrows(13.5,31.45,13.5,33.8, col=2,length=0.2,angle=20, code=2, lwd=2)
arrows(13.5,31.45,13.5,29.3, col=2,length=0.2,angle=20, code=2, lwd=2)
mtext(expression(t[min]),side=3,at=13.5, cex=1.2)

legend("bottomright", legend=c(expression(paste("k=0.4, ",p[0],"=0.25")),
                               expression(paste("k=1.2, ",p[0],"=0.25")),
                               expression(paste("k=0.2, ",p[0],"=0.25")),
                               expression(paste("k=0.4, ",p[0],"=0.35")),
                               expression(paste("k=0.4, ",p[0],"=0.15"))), 
                              lty=c(1,2,3,2,3), col=c(1,3,3,2,2))
#dev.off()
```

# Load data

```{r include=TRUE, echo=FALSE}
data<-readRDS("data/data_DiebnerEtAl.rds")
head(data)
## Parameter start values for fitting with drm:
  temperatureStart <- function(data) {
    C <- 37.674351
    r <- 0.066304
    k <- 0.3
    p <- 0.434651
    return(c(C,r,k,p))
  }
  parNames <- c("C", "r", "k","p")
```

```{r eval=FALSE, include=FALSE}
#################################
###### The Fitting Routine ######
#################################
if(FALSE){
  data$ID <- NA
  i = 1
  data$ID[1] <- 1
  for(j in (2:dim(data)[1])){
    if(data$Time[j]<data$Time[j-1])i = i+1
    data$ID[j] = i
  }
  data
  data$AUC = 0
  par(mfrow = c(5, 5))
  for(i in 1:max(data$ID)){
    print(i)
    fit<-drm(log(Temperature)~Time, curveid = Genotype, data = subset(data,ID==i), 
           fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), 
           pmodels=list(~1, ~1, ~1, ~1))
    plot(fit,main=i)
    func<-temperatureODE_gamma_shape3
    m <- as.matrix(coef(fit))
    parms<-c(m[1],m[2],m[3],m[4])
    initial<-m[1]
    output <- ode(y = initial, func = func, times = seq(0,48,by=.01), parms = parms, method = "daspk")
    auc<-AUC(x=output[,1], -output[,2]+m[1], from = min(x, na.rm = TRUE), to = max(x, na.rm = TRUE), 
        method = c("trapezoid"), absolutearea = FALSE) #, subdivisions = 100, na.rm = FALSE, ...)
    data$AUC[data$ID==i] <- auc
  }
  tail(data)
  data_auc_48 <- subset(data,Time==0)
#  saveRDS(data_auc_48,"AUC_data_Fig2A_48.rds", version=2)
#  saveRDS(data_auc,"AUC_data_Fig2A.rds", version=2)
}
```

# The genotypes "Casp1 WT" and "Casp1 WT X RIP2 KO": temperature curves and AUCs

```{r eval=TRUE, include=TRUE, echo=FALSE}
## Load one of the fits
fit2<-readRDS("data/fit2019_2_s3_G-G-G-G.rds")

## Extract the parameters for genotype Casp1 WT
parms<-c(coef(fit2)[5],coef(fit2)[11],coef(fit2)[17],coef(fit2)[23])
initial<-coef(fit2)[5] # Initial value for the ODE
func<-temperatureODE_gamma_shape3 # The ODE
output <- ode(y = initial, func = func, times = seq(0,24,by=.01), parms = parms, method = "daspk") # Solve ODE
plot(output) # Plot the ODE solution

## Compute the corresponding AUC for genotype Casp1 WT
auc1<-AUC(x=output[,1], -output[,2]+coef(fit2)[5], from = min(x, na.rm = TRUE), to = max(x, na.rm = TRUE), 
        method = c("trapezoid"), absolutearea = FALSE)

## The parameters for genotype Casp1 WT X RIP2 KO
parms<-c(coef(fit2)[6],coef(fit2)[12],coef(fit2)[18],coef(fit2)[24])
initial<-coef(fit2)[6]
func<-temperatureODE_gamma_shape3
output <- ode(y = initial, func = func, times = seq(0,24,by=.01), parms = parms, method = "daspk")
lines(output)

## Compute the corresponding AUC for genotype Casp1 WT X RIP2 KO
auc1
(auc2<-AUC(x=output[,1], -output[,2]+coef(fit2)[6], from = min(x, na.rm = TRUE), to = max(x, na.rm = TRUE), 
        method = c("trapezoid"), absolutearea = FALSE))
```
Note: The two curves are horizontally shifted against each other

The two AUCs are almost the same

# Load data including AUCs and calculate adjusted p-values for the pairwise comparisons of AUCs

```{r eval=TRUE, include=TRUE, echo=FALSE, fig.height = 10, fig.width = 14}
## Load data including the AUCs:
  data_auc <- readRDS("data/AUC_data_Fig2A.rds")
  # data_auc <- readRDS("data/AUC_data_Fig2A_48.rds")
  # dim(data_auc)
  par(mfrow = c(2, 2))
  fit2b <- readRDS("data/fit2019_2_s3_1-1-G-G.rds")
  ## plot the temperature-courses for each genotype for an overview:
  plot(fit2b, type="average", legendPos = c(55.0,3.4), cex.legend=0.8, log="", legend=T,
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")

  ######################################################################################
  ###        Distribution of temperatures at t=24h + Moments     #######################
  ######################################################################################
  data_24 <- subset(data,Time==24)
  boxplot(data_24$Temperature~data_auc$Genotype, xaxt="n", xlab="", ylab="temperature at t=24h")
  lab <- levels(data_auc$Genotype)
  axis(1, at = 1:6, labels = lab, las=2)
  m_Temp<-aggregate(data_24$Temperature, list(genotype=data_24$Genotype), mean, na.rm=T)
  sd_Temp<-aggregate(data_24$Temperature, list(genotype=data_24$Genotype), sd, na.rm=T)
  (varcoef_Temp<-sd_Temp$x/m_Temp$x)
  summary(data_24)
  ## ANOVA
  summary(lm(Temperature~Genotype,data=data_24))

  ######################################################################################
  ###     Distribution of AUCs + Moments       #########################################
  ######################################################################################
  m_auc<-aggregate(data_auc$AUC, list(genotype=data_auc$Genotype), mean, na.rm=T)
  sd_auc<-aggregate(data_auc$AUC, list(genotype=data_auc$Genotype), sd, na.rm=T)
  boxplot(data_auc$AUC~data_auc$Genotype, xaxt="n", xlab="", ylab="AUC", varwidth=T)
  points(m_auc$x,col=2,pch=19)
  lab <- levels(data_auc$Genotype)
  axis(1, at = 1:6, labels = lab, las=2)
  (varcoef_auc<-sd_auc$x/m_auc$x)
  summary(data_auc)
  ## ANOVA
  summary(lm(AUC~Genotype,data=data_auc))

  ######################################################################################
  ###     Testing genotype-dependent differences of the AUCs using pairwise t-tests   ##
  ######################################################################################
  p = rep(0,15)
  # data_auc$Genotype
  p[1] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 C284A x RIP2KO"]))$p.value
  p[2] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 KO"]))$p.value
  p[3] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 KO x RIP2KO"]))$p.value
  p[4] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 WT"]))$p.value
  p[5] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 WT x RIP2KO"]))$p.value
  
  p[6] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A x RIP2KO"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 KO"]))$p.value
  p[7] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A x RIP2KO"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 KO x RIP2KO"]))$p.value
  p[8] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A x RIP2KO"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 WT"]))$p.value
  p[9] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 C284A x RIP2KO"],
                 data_auc$AUC[data_auc$Genotype=="Casp1 WT x RIP2KO"]))$p.value
  
  p[10] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 KO"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 KO x RIP2KO"]))$p.value
  p[11] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 KO"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 WT"]))$p.value
  p[12] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 KO"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 WT x RIP2KO"]))$p.value
  
  p[13] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 KO x RIP2KO"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 WT"]))$p.value
  p[14] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 KO x RIP2KO"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 WT x RIP2KO"]))$p.value
  
  p[15] = (t.test(data_auc$AUC[data_auc$Genotype=="Casp1 WT"],
                  data_auc$AUC[data_auc$Genotype=="Casp1 WT x RIP2KO"]))$p.value
  
  ## Adjusted p-values for the pairwise comparisons of AUCs
  ## p-values for column 5 of table 1 of the Publication Diebner et al.:
  round(p.adjust(p, method = "BH", n = length(p)),digits=4)
```

# Power and Sample Size on the Basis of t-tests
## 1) Temperature at t=24h
## 2) AUC

```{r eval=TRUE, include=TRUE, echo=FALSE}
  ######################################################################################
  ####      power for the pair Casp1KO vs Casp1 C284                               #####
  ######################################################################################
  ######################################################################################
  ###                Temperature at t=24h                                           ####
  ######################################################################################
  # m_Temp
  # sd_Temp
  # summary(data_24)
  ## t-test highly significant
  t.test(data_24$Temperature[data_24$Genotype=="Casp1 KO"], 
         data_24$Temperature[data_24$Genotype=="Casp1 C284A"])
  ## mean and standard deviation
  m.Casp1KO <- m_Temp$x[3]
  m.Casp1284 <- m_Temp$x[1]
  sd.Casp1KO <- sd_Temp$x[3]
  sd.Casp1284 <- sd_Temp$x[1]
  ## pooled variance
  df.Casp1KO <- 57
  df.Casp1284 <- 64
  var.pool <-var.pooled(df1 = df.Casp1KO-1, df2 = df.Casp1284-1, SD1 = sd.Casp1KO, SD2 = sd.Casp1284)
  ## standard deviation for the difference
  sd.dif <- sqrt(var.pool)
  se.dif <- SE.diff(var.pool, n1 = 56, n2 = 17)
  effect.size.temp <- m.Casp1KO - m.Casp1284
  # Power on the basis of the observed values (n1, n2):
  pwr.t2n.test(n1 = df.Casp1KO, n2= df.Casp1284, d = effect.size.temp/sd.dif, sig.level = 0.05)
  # Recalculate n for a power=0.8 and the given SD and effect size:
  pwr.t.test(d = effect.size.temp/sd.dif, sig.level = 0.05, power = 0.8, 
             type = "two.sample", alternative="two.sided")
  ###### Important aspect for the publication Diebner et al.    ######
  ###### We need 21 mice per genotype to detect the difference  ######

  ######################################################################################
  ####      power for the pair Casp1KO vs Casp1 C284                               #####
  ######################################################################################
  ######################################################################################
  ###                AUC                                                            ####
  ######################################################################################
  m_auc
  sd_auc
  df.Casp1KO <- 57
  df.Casp1284 <- 64
  m.Casp1KO <- m_auc$x[3]
  m.Casp1284 <- m_auc$x[1]
  sd.Casp1KO <- sd_auc$x[3]
  sd.Casp1284 <- sd_auc$x[1]
  var.pool.2 <-var.pooled(df1 = df.Casp1KO-1, df2 = df.Casp1284-1, SD1 = sd.Casp1KO, SD2 = sd.Casp1284)
  se.dif.2 <- SE.diff(var.pool.2, n1 = df.Casp1KO, n2 = df.Casp1284)
  effect.size.auc.2 <- m.Casp1KO - m.Casp1284
  sd.dif.2 <- sqrt(var.pool.2)
  # Power (n1, n2):
  pwr.t2n.test(n1 = df.Casp1KO, n2= df.Casp1284, d = effect.size.auc.2/sd.dif.2, sig.level = 0.05)
  # Power (n):
  pwr.t.test(d = effect.size.auc.2/sd.dif.2, sig.level = 0.05, power = 0.8, type = "two.sample",
             alternative="two.sided")
  ###### Important aspect for the publication Diebner et al.         ######
  ###### We need only 10 mice per genotype to detect the difference  ######
  ############################################################################################################
  ############################################################################################################
```

```{r eval=FALSE, include=FALSE, echo=FALSE}
### The drc-Fit-Routines
### This junk documents the history of the fits. Results have been saved to rds-files

### ... has to be adapted to the desired covariables in Parameter model (pmodels) 
if(FALSE){
  fit<-drm(log(Temperature)~Time, curveid = Genotype, data = data,
           fct = list(temperatureModel_gamma_shape4,temperatureStart,parNames), 
           pmodels=list(~1, ~Genotype-1, ~Genotype-1, ~Genotype-1))
  logLik(fit)
  plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=19, col=c(1,2,3,4,5,6), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", 
       ylab="log(T(t))", main="")
  ### save:
  saveRDS(fit,"fit2019_2_s4_1-G-G-G.rds", version=2)
}

## select 6 time series per genotype
if(FALSE){
  data_reduced4<-data[c(1:30,316:345,606:635,1116:1145,756:785,1031:1060),]
  data_reduced4<-data.frame(data_reduced4)
  fit<-drm(log(Temperature)~Time, curveid = Genotype, data = data_reduced4,
           fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), 
           pmodels=list(~1, ~Genotype-1, ~Genotype-1, ~Genotype-1))
  logLik(fit)
  plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=19, col=c(1,2,3,4,5,6), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="")

  ## again select 6 time series per genotype
  data_reduced5<-data[c(31:60,346:375,636:665,1146:1175,786:815,1061:1090),]
  data_reduced5<-data.frame(data_reduced5)
  fit<-drm(log(Temperature)~Time, curveid = Genotype, data = data_reduced5,
           fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), 
           pmodels=list(~1, ~Genotype-1, ~Genotype-1, ~Genotype-1))
  logLik(fit)
  plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=19, col=c(1,2,3,4,5,6), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", 
       ylab="log(T(t))", main="")

  ## once more select 6 time series per genotype
  subset(data,Genotype=="Casp1 C284A")
  subset(data,Genotype=="Casp1 C284A x RIP2KO")
  subset(data,Genotype=="Casp1 KO")
  subset(data,Genotype=="Casp1 KO x RIP2KO")
  subset(data,Genotype=="Casp1 WT")
  subset(data,Genotype=="Casp1 WT x RIP2KO")
  data_reduced6<-data[c(61:90,376:405,721:750,1156:1185,816:845,1086:1115),]
  data_reduced6<-data.frame(data_reduced6)
  fit<-drm(log(Temperature)~Time, curveid = Genotype, data = data_reduced6,
           fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), 
           pmodels=list(~1, ~Genotype-1, ~Genotype-1, ~Genotype-1))
  logLik(fit)
  par(mfrow=c(1,1), mar=c(5, 5, 4, 2) + 0.1)
  plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=19, col=c(1,2,3,4,5,6), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", 
       ylab="log(T(t))", main="")
  ### save:
  saveRDS(fit,"fit_6ts1_s3_1-G-G-G.rds", version=2)
  saveRDS(fit,"fit_6ts2_s3_1-G-G-G.rds", version=2)
  saveRDS(fit,"fit_6ts3_s3_1-G-G-G.rds", version=2)
}

## pairwise comparisons of the Genotypes
## This part of the code was needed for the Likelihood-Ratio-Tests
## The results have been stored to .rds-files
if(FALSE){
  for(i in 14:15){
  data$Genotype1<-data$Genotype
  if(i==1)data$Genotype1[data$Genotype1=="Casp1 C284A"] = "Casp1 C284A x RIP2KO"
  if(i==2)data$Genotype1[data$Genotype1=="Casp1 C284A"] = "Casp1 KO"
  if(i==3)data$Genotype1[data$Genotype1=="Casp1 C284A"] = "Casp1 KO x RIP2KO"
  if(i==4)data$Genotype1[data$Genotype1=="Casp1 C284A"] = "Casp1 WT"
  if(i==5)data$Genotype1[data$Genotype1=="Casp1 C284A"] = "Casp1 WT x RIP2KO"

  if(i==6)data$Genotype1[data$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO"
  if(i==7)data$Genotype1[data$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO x RIP2KO"
  if(i==8)data$Genotype1[data$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT"
  if(i==9)data$Genotype1[data$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==10)data$Genotype1[data$Genotype1=="Casp1 KO"] = "Casp1 KO x RIP2KO"
  if(i==11)data$Genotype1[data$Genotype1=="Casp1 KO"] = "Casp1 WT"
  if(i==12)data$Genotype1[data$Genotype1=="Casp1 KO"] = "Casp1 WT x RIP2KO"

  if(i==13)data$Genotype1[data$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT"
  if(i==14)data$Genotype1[data$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==15)data$Genotype1[data$Genotype1=="Casp1 WT"] = "Casp1 WT x RIP2KO"
  data$Genotype1<-factor(data$Genotype1)
  
  fit<-drm(log(Temperature)~Time, curveid = Genotype1, data = subset(data,Time<34), 
  fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), pmodels=list(~1, ~Genotype1-1, ~Genotype1-1, ~Genotype1-1), 
  control = drmc(constr = TRUE))
  if(i==1)saveRDS(fit,"fit2019_2_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==2)saveRDS(fit,"fit2019_2_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==3)saveRDS(fit,"fit2019_2_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==4)saveRDS(fit,"fit2019_2_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==5)saveRDS(fit,"fit2019_2_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==6)saveRDS(fit,"fit2019_2_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==7)saveRDS(fit,"fit2019_2_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==8)saveRDS(fit,"fit2019_2_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==9)saveRDS(fit,"fit2019_2_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==10)saveRDS(fit,"fit2019_2_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==11)saveRDS(fit,"fit2019_2_Casp1KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==12)saveRDS(fit,"fit2019_2_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==13)saveRDS(fit,"fit2019_2_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==14)saveRDS(fit,"fit2019_2_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==15)saveRDS(fit,"fit2019_2_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)
  }
  # plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=19, col=c(2,3), 
  # xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="")
}

####################################################################################################
##           Restricted dataset - 6 time series per genotype                              ##########
####################################################################################################
## First restricted dataset
if(FALSE){
  for(i in 1:15){
  data_reduced4$Genotype1<-data_reduced4$Genotype
  if(i==1)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A"] = "Casp1 C284A x RIP2KO"
  if(i==2)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A"] = "Casp1 KO"
  if(i==3)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A"] = "Casp1 KO x RIP2KO"
  if(i==4)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A"] = "Casp1 WT"
  if(i==5)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A"] = "Casp1 WT x RIP2KO"

  if(i==6)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO"
  if(i==7)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO x RIP2KO"
  if(i==8)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT"
  if(i==9)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==10)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 KO"] = "Casp1 KO x RIP2KO"
  if(i==11)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 KO"] = "Casp1 WT"
  if(i==12)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 KO"] = "Casp1 WT x RIP2KO"

  if(i==13)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT"
  if(i==14)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==15)data_reduced4$Genotype1[data_reduced4$Genotype1=="Casp1 WT"] = "Casp1 WT x RIP2KO"
  data_reduced4$Genotype1<-factor(data_reduced4$Genotype1)
  
  fit<-drm(log(Temperature)~Time, curveid = Genotype1, data = data_reduced4, 
  fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), pmodels=list(~1, ~Genotype1-1, ~Genotype1-1, ~Genotype1-1), 
  control = drmc(constr = TRUE))
  if(i==1)saveRDS(fit,"fit_6ts1_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==2)saveRDS(fit,"fit_6ts1_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==3)saveRDS(fit,"fit_6ts1_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==4)saveRDS(fit,"fit_6ts1_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==5)saveRDS(fit,"fit_6ts1_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==6)saveRDS(fit,"fit_6ts1_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==7)saveRDS(fit,"fit_6ts1_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==8)saveRDS(fit,"fit_6ts1_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==9)saveRDS(fit,"fit_6ts1_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==10)saveRDS(fit,"fit_6ts1_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==11)saveRDS(fit,"fit_6ts1_Casp1KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==12)saveRDS(fit,"fit_6ts1_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==13)saveRDS(fit,"fit_6ts1_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==14)saveRDS(fit,"fit_6ts1_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==15)saveRDS(fit,"fit_6ts1_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)
  }
  # plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=19, col=c(2,3), 
  # xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="")
}
## Second restricted dataset
if(FALSE){
  for(i in 1:15){
  data_reduced5$Genotype1<-data_reduced5$Genotype
  if(i==1)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A"] = "Casp1 C284A x RIP2KO"
  if(i==2)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A"] = "Casp1 KO"
  if(i==3)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A"] = "Casp1 KO x RIP2KO"
  if(i==4)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A"] = "Casp1 WT"
  if(i==5)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A"] = "Casp1 WT x RIP2KO"

  if(i==6)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO"
  if(i==7)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO x RIP2KO"
  if(i==8)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT"
  if(i==9)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==10)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 KO"] = "Casp1 KO x RIP2KO"
  if(i==11)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 KO"] = "Casp1 WT"
  if(i==12)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 KO"] = "Casp1 WT x RIP2KO"

  if(i==13)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT"
  if(i==14)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==15)data_reduced5$Genotype1[data_reduced5$Genotype1=="Casp1 WT"] = "Casp1 WT x RIP2KO"
  data_reduced5$Genotype1<-factor(data_reduced5$Genotype1)
  
  fit<-drm(log(Temperature)~Time, curveid = Genotype1, data = data_reduced5, 
  fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), pmodels=list(~1, ~Genotype1-1, ~Genotype1-1, ~Genotype1-1), 
  control = drmc(constr = TRUE))
  if(i==1)saveRDS(fit,"fit_6ts2_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==2)saveRDS(fit,"fit_6ts2_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==3)saveRDS(fit,"fit_6ts2_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==4)saveRDS(fit,"fit_6ts2_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==5)saveRDS(fit,"fit_6ts2_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==6)saveRDS(fit,"fit_6ts2_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==7)saveRDS(fit,"fit_6ts2_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==8)saveRDS(fit,"fit_6ts2_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==9)saveRDS(fit,"fit_6ts2_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==10)saveRDS(fit,"fit_6ts2_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==11)saveRDS(fit,"fit_6ts2_Casp1KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==12)saveRDS(fit,"fit_6ts2_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==13)saveRDS(fit,"fit_6ts2_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==14)saveRDS(fit,"fit_6ts2_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==15)saveRDS(fit,"fit_6ts2_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)
  }
  # plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=19, col=c(2,3), 
  # xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="")
}
## Third restricted dataset
if(FALSE){
  temperatureStart <- function(data) {
      C <- 37.674351
      r <- 0.066304
      k <- 0.2
      p <- 0.434651
      return(c(C,r,k,p))
  }
  for(i in 4:15){
  data_reduced6$Genotype1<-data_reduced6$Genotype
  if(i==1)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A"] = "Casp1 C284A x RIP2KO"
  if(i==2)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A"] = "Casp1 KO"
  if(i==3)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A"] = "Casp1 KO x RIP2KO"
  if(i==4)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A"] = "Casp1 WT"
  if(i==5)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A"] = "Casp1 WT x RIP2KO"

  if(i==6)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO"
  if(i==7)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 KO x RIP2KO"
  if(i==8)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT"
  if(i==9)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 C284A x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==10)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 KO"] = "Casp1 KO x RIP2KO"
  if(i==11)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 KO"] = "Casp1 WT"
  if(i==12)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 KO"] = "Casp1 WT x RIP2KO"

  if(i==13)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT"
  if(i==14)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 KO x RIP2KO"] = "Casp1 WT x RIP2KO"

  if(i==15)data_reduced6$Genotype1[data_reduced6$Genotype1=="Casp1 WT"] = "Casp1 WT x RIP2KO"
  data_reduced6$Genotype1<-factor(data_reduced6$Genotype1)
  
  fit<-drm(log(Temperature)~Time, curveid = Genotype1, data = data_reduced6, 
  fct = list(temperatureModel_gamma_shape3,temperatureStart,parNames), pmodels=list(~1, ~Genotype1-1, ~Genotype1-1, ~Genotype1-1), 
  control = drmc(constr = TRUE))
  if(i==1)saveRDS(fit,"fit_6ts3_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==2)saveRDS(fit,"fit_6ts3_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==3)saveRDS(fit,"fit_6ts3_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==4)saveRDS(fit,"fit_6ts3_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==5)saveRDS(fit,"fit_6ts3_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==6)saveRDS(fit,"fit_6ts3_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds", version=2)
  if(i==7)saveRDS(fit,"fit_6ts3_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==8)saveRDS(fit,"fit_6ts3_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==9)saveRDS(fit,"fit_6ts3_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==10)saveRDS(fit,"fit_6ts3_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds", version=2)
  if(i==11)saveRDS(fit,"fit_6ts3_Casp1KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==12)saveRDS(fit,"fit_6ts3_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==13)saveRDS(fit,"fit_6ts3_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds", version=2)
  if(i==14)saveRDS(fit,"fit_6ts3_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)

  if(i==15)saveRDS(fit,"fit_6ts3_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds", version=2)
  }
  # system('shutdown')
  # plot(fit, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=19, col=c(2,3), 
  # xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="")
}
```

# The Model Fits / Model Selection

```{r eval=TRUE, include=TRUE, echo=FALSE, fig.width=14, fig.height=20}
  ######################## The s=1 Series #####################################################
  par(mfrow=c(3,2), mar=c(5, 5, 4, 2) + 0.1)
  fit0<-readRDS("data/fit2019_2_s1_G-G-G-G.rds")
  plot(fit0, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=1")
  fit0a<-readRDS("data/fit2019_2_s1_1-G-G-G.rds")
  plot(fit0a, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=1")
  fit0b<-readRDS("data/fit2019_2_s1_1-1-G-G.rds")
  plot(fit0b, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=1")
  fit0c<-readRDS("data/fit2019_2_s1_1-1-1-G.rds")
  plot(fit0c, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=1")
  fit0d<-readRDS("data/fit2019_2_s1_1-1-G-1.rds")
  plot(fit0d, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=1")
  anova(fit0,fit0a) # C
  anova(fit0,fit0b) # r
  anov<-anova(fit0,fit0c) # k
  anov$`p value`
  anov<-anova(fit0,fit0d) # p
  anov$`p value`
  
  ######################## The s=2 Series #####################################################
  par(mfrow=c(3,2), mar=c(5, 5, 4, 2) + 0.1)
  fit1<-readRDS("data/fit2019_2_s2_G-G-G-G.rds")
  plot(fit1, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=2")
  fit1a<-readRDS("data/fit2019_2_s2_1-G-G-G.rds")
  plot(fit1a, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=2")
  fit1b<-readRDS("data/fit2019_2_s2_1-1-G-G.rds")
  plot(fit1b, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=2")
  fit1c<-readRDS("data/fit2019_2_s2_1-1-1-G.rds")
  plot(fit1c, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=2")
  fit1d<-readRDS("data/fit2019_2_s2_1-1-G-1.rds")
  plot(fit1d, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=2")
  anova(fit1,fit1a) # C
  anova(fit1,fit1b) # r
  format(anova(fit1,fit1d), scientific=T) # k
  anov<-anova(fit1d,fit1) # p
  format(anov$`p value`,scientific=T,digits=20)
  dchisq(2*logLik(fit1)-2*logLik(fit0),1) 
  dchisq(2*logLik(fit1a)-2*logLik(fit0a),1) 
  dchisq(2*logLik(fit1b)-2*logLik(fit0b),1) 
  dchisq(2*logLik(fit1c)-2*logLik(fit0c),1) 
  dchisq(2*logLik(fit0d)-2*logLik(fit1d),1) 
  
  ######################## The s=3 Series #####################################################
  
  par(mfrow=c(3,2), mar=c(5, 5, 4, 2) + 0.1)
  fit2<-readRDS("data/fit2019_2_s3_G-G-G-G.rds")
  plot(fit2, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")
  fit2a<-readRDS("data/fit2019_2_s3_1-G-G-G.rds")
  plot(fit2a, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")
  fit2b<-readRDS("data/fit2019_2_s3_1-1-G-G.rds")
  plot(fit2b, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")
  fit2c<-readRDS("data/fit2019_2_s3_1-1-1-G.rds")
  plot(fit2c, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")
  fit2d<-readRDS("data/fit2019_2_s3_1-1-G-1.rds")
  plot(fit2d, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, 
       pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), 
       xlab="time [h]", ylab="log(T(t))", main="s=3")

######################## The s=4 Series #####################################################

fit3<-readRDS("data/fit2019_2_s4_G-G-G-G.rds")
plot(fit3, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="s=4")

dchisq(2*logLik(fit2)-2*logLik(fit3),1) 
```

# Likelihood-Ratio-Tests (pairwise genotype comparisons)

```{r eval=TRUE, include=TRUE, echo=FALSE, fig.width=14, fig.height=8}
par(mfrow=c(1,1), mar=c(5, 5, 4, 2) + 0.1)

################################################################################################################
####                       Likelihood-Ratio-Tests for the full dataset                                  ########
################################################################################################################

plot(fit2a, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=19, lty=1,
     col=c(1,2,3,4,5,6), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="")

p<-NULL
fit2a_Casp1C284AvsCasp1C284AxRIP2KO<-readRDS("data/fit2019_2_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1C284AxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KO<-readRDS("data/fit2019_2_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KOxRIP2KO<-readRDS("data/fit2019_2_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KOxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WT<-readRDS("data/fit2019_2_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WT,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WTxRIP2KO<-readRDS("data/fit2019_2_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WTxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KO <- readRDS("data/fit2019_2_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO <- readRDS("data/fit2019_2_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WT <- readRDS("data/fit2019_2_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WT,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit2019_2_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1KOxRIP2KO <- readRDS("data/fit2019_2_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1KOxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WT <- readRDS("data/fit2019_2_Casp1KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WT,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WTxRIP2KO <- readRDS("data/fit2019_2_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WTxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WT <- readRDS("data/fit2019_2_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WT,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit2019_2_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1WTvsCasp1WTxRIP2KO <- readRDS("data/fit2019_2_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1WTvsCasp1WTxRIP2KO,fit2a,test="LRT")
p<-c(p,a$`p value`[2])

round(p.adjust(p, method = "BH", n = length(p)),digits=4)


####################################################################################################################
#####           LRT: 6 time series per genotype reduced data set                                           #########
####################################################################################################################

fit2a_reduced<-readRDS("data/fit_6ts1_s3_1-G-G-G.rds")
plot(fit2a_reduced, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="s=3")

p<-NULL
fit2a_Casp1C284AvsCasp1C284AxRIP2KO<-readRDS("data/fit_6ts1_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1C284AxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KO<-readRDS("data/fit_6ts1_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KOxRIP2KO<-readRDS("data/fit_6ts1_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WT<-readRDS("data/fit_6ts1_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WTxRIP2KO<-readRDS("data/fit_6ts1_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KO <- readRDS("data/fit_6ts1_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts1_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts1_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts1_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts1_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WT <- readRDS("data/fit_6ts1_Casp1KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts1_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts1_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts1_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1WTvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts1_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1WTvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

round(p.adjust(p, method = "BH", n = length(p)),digits=4)


####################################################################################################################
#####   Another to 6 time series per genotype reduced data set                                             #########
####################################################################################################################

fit2a_reduced<-readRDS("data/fit_6ts2_s3_1-G-G-G.rds")
plot(fit2a_reduced, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="s=3")

p<-NULL
fit2a_Casp1C284AvsCasp1C284AxRIP2KO<-readRDS("data/fit_6ts2_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1C284AxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KO<-readRDS("data/fit_6ts2_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KOxRIP2KO<-readRDS("data/fit_6ts2_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WT<-readRDS("data/fit_6ts2_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WTxRIP2KO<-readRDS("data/fit_6ts2_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KO <- readRDS("data/fit_6ts2_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts2_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts2_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts2_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts2_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WT <- readRDS("data/fit_6ts2_Casp1KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts2_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts2_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts2_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1WTvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts2_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1WTvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

round(p.adjust(p, method = "BH", n = length(p)),digits=4)


####################################################################################################################
#####   Another to 6 time series per genotype reduced data set                                             #########
####################################################################################################################

fit2a_reduced<-readRDS("data/fit_6ts3_s3_1-G-G-G.rds")
plot(fit2a_reduced, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="s=3")

p<-NULL
fit2a_Casp1C284AvsCasp1C284AxRIP2KO<-readRDS("data/fit_6ts3_Casp1C284AvsCasp1C284AxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1C284AxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KO<-readRDS("data/fit_6ts3_Casp1C284AvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1KOxRIP2KO<-readRDS("data/fit_6ts3_Casp1C284AvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WT<-readRDS("data/fit_6ts3_Casp1C284AvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AvsCasp1WTxRIP2KO<-readRDS("data/fit_6ts3_Casp1C284AvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KO <- readRDS("data/fit_6ts3_Casp1C284AxRIP2KOvsCasp1KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts3_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts3_Casp1C284AxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts3_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1C284AxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1KOxRIP2KO <- readRDS("data/fit_6ts3_Casp1KOvsCasp1KOxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1KOxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WT <- readRDS("data/fit_6ts3_Casp1KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts3_Casp1KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WT <- readRDS("data/fit_6ts3_Casp1KOxRIP2KOvsCasp1WT_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WT,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts3_Casp1KOxRIP2KOvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1KOxRIP2KOvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

fit2a_Casp1WTvsCasp1WTxRIP2KO <- readRDS("data/fit_6ts3_Casp1WTvsCasp1WTxRIP2KO_s3_1-G-G-G.rds")
a<-anova(fit2a_Casp1WTvsCasp1WTxRIP2KO,fit2a_reduced,test="LRT")
p<-c(p,a$`p value`[2])

round(p.adjust(p, method = "BH", n = length(p)),digits=4)
```



```{r eval=FALSE, include=FALSE, echo=FALSE, fig.width=14, fig.height=8}
### Some intermediate steps, part of the model selection procedure

pairwise.t.test(data$Temperature[data$Time==24], data$Genotype[data$Time==24], p.adjust.method = "BH", paired = FALSE, alternative = c("two.sided"))
pairwise.wilcox.test(data$Temperature[data$Time==24], data$Genotype[data$Time==24], p.adjust.method = "BH", paired = FALSE, alternative = c("two.sided"))

fit2b<-readRDS("data/fit2019_2_s3_1-1-G-G.rds")
plot(fit2b, type="average", legendPos = c(55.0,3.32), cex.legend=0.8, log="", legend=T, pch=c(19,17,19,17,19,17), col=c(2,2,4,4,1,1), lty=c(1,2,1,2,1,2), xlim=c(0,50), ylim=c(3.2,3.65), xlab="time [h]", ylab="log(T(t))", main="s=3")
dchisq(2*logLik(fit2)-2*logLik(fit1),1) # 
dchisq(2*logLik(fit2)-2*logLik(fit0),2) # 
dchisq(2*logLik(fit2a)-2*logLik(fit1a),1) # 
dchisq(2*logLik(fit1b)-2*logLik(fit2b),1) # 
anova(fit2,fit2a,test="LRT") 
anova(fit2,fit2b,test="LRT") 
anova(fit2,fit2b,test="LRT") 
anova(fit2a,fit2b,test="LRT") 
anov<-anova(fit2,fit2c,test="LRT") 
anov$`p value`
anov<-anova(fit2,fit2d,test="LRT") 
anov$`p value`
```

#  Plotting the solution of the model fit using the optimal parameter set
## Corresponds to fig 2 of the publication

```{r eval=TRUE, include=TRUE, echo=FALSE, fig.width=14, fig.height=14}

#########################################################################################################
####  The fitted Curves    ##############################################################################
#########################################################################################################

#######     Fig2 of the Publication     ########

#cairo_pdf("Fig2.pdf", height=6, width=9)
data$logTemp <- log(data$Temperature)
ci <- group.CI(logTemp ~ Genotype + Time, data=data, ci = 0.90)
par(mfrow=c(1,1), mar=c(5, 5, 4, 2) + 0.1)
fit = fit2b

func<-temperatureODE_gamma_shape3
cic <- confint(fit,level=0.9)
m <- as.matrix(coef(fit))

parms<-c(m[1],m[2],m[3],m[9])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
plot(output[,1], output[,2], type="l", xlim=c(0,50), ylim=c(25,38), col=2, xlab="Time t [h]", ylab="Temperature T(t) [°C]", main="", cex=1.4, cex.main=1.4, cex.axis = 1.4, cex.lab = 1.4, lwd=2)

parms<-c(m[1],m[2],m[4],m[10])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output, col=2, lty=2, lwd=2)

parms<-c(m[1], m[2], m[5], m[11])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output, col=4, lty=1, lwd=2)

parms<-c(m[1], m[2], m[6], m[12])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output, col=4, lty=2, lwd=2)

parms<-c(m[1], m[2], m[7], m[13])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output, col=1, lty=1, lwd=2)

parms<-c(m[1], m[2], m[8], m[14])
initial<-m[1]
output <- ode(y = initial, func = func, times = seq(0,60,by=.1), parms = parms, method = "daspk")
lines(output, col=1, lty=2, lwd=2)

delta=0.3

points(ci$Time[ci$Genotype=="Casp1 C284A"], exp(ci$logTemp.mean[ci$Genotype=="Casp1 C284A"]), pch=19, col=2, cex=1.2)
points(ci$Time[ci$Genotype=="Casp1 C284A x RIP2KO"], exp(ci$logTemp.mean[ci$Genotype=="Casp1 C284A x RIP2KO"]), pch=17, col=2, cex=1.2)
points(ci$Time[ci$Genotype=="Casp1 KO"]+delta, exp(ci$logTemp.mean[ci$Genotype=="Casp1 KO"]), pch=19, col=4, cex=1.2)
points(ci$Time[ci$Genotype=="Casp1 KO x RIP2KO"]-delta, exp(ci$logTemp.mean[ci$Genotype=="Casp1 KO x RIP2KO"]), pch=17, col=4, cex=1.2)
points(ci$Time[ci$Genotype=="Casp1 WT"], exp(ci$logTemp.mean[ci$Genotype=="Casp1 WT"]), pch=19, col=1, cex=1.2)
points(ci$Time[ci$Genotype=="Casp1 WT x RIP2KO"]+delta, exp(ci$logTemp.mean[ci$Genotype=="Casp1 WT x RIP2KO"]), pch=17, col=1, cex=1.2)

arrows(ci$Time[ci$Genotype=="Casp1 C284A"], exp(ci$logTemp.upper[ci$Genotype=="Casp1 C284A"]), ci$Time[ci$Genotype=="Casp1 C284A"], exp(ci$logTemp.lower[ci$Genotype=="Casp1 C284A"]), length=.05, angle=90, code=3, col=2, lwd=2)
arrows(ci$Time[ci$Genotype=="Casp1 C284A x RIP2KO"], exp(ci$logTemp.upper[ci$Genotype=="Casp1 C284A x RIP2KO"]), ci$Time[ci$Genotype=="Casp1 C284A x RIP2KO"], exp(ci$logTemp.lower[ci$Genotype=="Casp1 C284A x RIP2KO"]), length=.05, angle=90, code=3, col=2, lty=2, lwd=2)

arrows(ci$Time[ci$Genotype=="Casp1 KO"]+delta, exp(ci$logTemp.upper[ci$Genotype=="Casp1 KO"]), ci$Time[ci$Genotype=="Casp1 KO"]+delta, exp(ci$logTemp.lower[ci$Genotype=="Casp1 KO"]), length=.05, angle=90, code=3, col=4, lwd=2)
arrows(ci$Time[ci$Genotype=="Casp1 KO x RIP2KO"]-delta, exp(ci$logTemp.upper[ci$Genotype=="Casp1 KO x RIP2KO"]), ci$Time[ci$Genotype=="Casp1 KO x RIP2KO"]-delta, exp(ci$logTemp.lower[ci$Genotype=="Casp1 KO x RIP2KO"]), length=.05, angle=90, code=3, col=4, lwd=2, lty=2)

arrows(ci$Time[ci$Genotype=="Casp1 WT"], exp(ci$logTemp.upper[ci$Genotype=="Casp1 WT"]), ci$Time[ci$Genotype=="Casp1 WT"], exp(ci$logTemp.lower[ci$Genotype=="Casp1 WT"]), length=.05, angle=90, code=3, col=1, lwd=2)
arrows(ci$Time[ci$Genotype=="Casp1 WT x RIP2KO"]+delta, exp(ci$logTemp.upper[ci$Genotype=="Casp1 WT x RIP2KO"]), ci$Time[ci$Genotype=="Casp1 WT x RIP2KO"]+delta, exp(ci$logTemp.lower[ci$Genotype=="Casp1 WT x RIP2KO"]), length=.05, angle=90, code=3, col=1, lwd=2, lty=2)

labels=c("Casp1 C284A","Casp1 C284A x RIP2KO","Casp1 KO","Casp1 KO x RIP2KO","Casp1 WT","Casp1 WT x RIP2KO")
legend("bottomright", legend=labels, col=c(2,2,4,4,1,1), pch=c(19,17,19,17,19,17), lty=c(1,2,1,2,1,2), cex=1.1, bty = "n")

#dev.off()
```


# Plotting the estimated model parameters (barplot)

```{r eval=TRUE, include=TRUE, echo=FALSE, fig.width=14, fig.height=8}
########################################################################################################
#### Barplot of the Parameters k and p0    #############################################################
########################################################################################################

fit=fit2b
c_int<-confint(fit,level=0.9)
ausgabe = data.frame("Parameter" = c(rep("k",6), rep("p",6)), 
      "Genotype" = rep(c("Casp1 C284A", "Casp1 C284A x RIP2KO", "Casp1 KO", "Casp1 KO x RIP2KO", "Casp1 WT", "Casp1 WT x RIP2KO"), 2), 
      "CI5" = c_int[3:14,1], 
      "mean" = as.numeric(coef(fit)[3:14]), 
      "CI95"=c_int[3:14,2])
require(ggplot2)
require(cowplot)

## k und p_0
ggplot(subset(ausgabe,Parameter=="k"), aes(factor(Genotype), mean)) + 
  geom_bar(position=position_dodge(), stat="identity") + 
#  scale_fill_brewer(palette = "Set1") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  geom_errorbar(aes(ymin=CI5, ymax=CI95), width=.2, position=position_dodge(0.9)) + 
  ylab("k") + xlab("Genotype")

ggplot(subset(ausgabe,Parameter=="p"), aes(factor(Genotype), mean)) + 
  geom_bar(position=position_dodge(), stat="identity") + 
#  scale_fill_brewer(palette = "Set1") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  geom_errorbar(aes(ymin=CI5, ymax=CI95), width=.2, position=position_dodge(0.9)) + 
  ylab(expression(p[0])) + xlab("Genotype")

require(latex2exp)
arr <- list('k'=TeX("k"), "p"=TeX("p_0"))
mylabel <- function(val) { return(lapply(val, function(x) arr[x])) }

gg3<-ggplot(ausgabe, aes(factor(Genotype), mean)) + theme_bw() + 
  geom_bar(position=position_dodge(), stat="identity", alpha=0.6) + 
#  scale_fill_manual("shape", values = c("s1" = "black", "s2" = "green", "s3" = "blue", "s4" = "red"), labels = c("1","2","3","4")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  geom_errorbar(aes(ymin=CI5, ymax=CI95), width=.6, position=position_dodge(0.9)) + 
  ylab("Parameter value") + xlab("Genotype") + 
  facet_grid(cols = vars(Parameter), labeller = mylabel) + theme(legend.key.width = unit(1,"cm"), legend.key.size = unit(1.2, "mm")) +
  theme(legend.position = c(0.15, 0.8), legend.text=element_text(size=6), plot.title = element_text(size = 10))  
# + ggtitle("Parameter values for data set \"Anakinra\" by genotype and shape")

cp1<-compParm(fit2b, "p", "/", display=T)
cp1<-data.frame(cp1)

if(cp1$p.value[6]>0.05){
segdf <- structure(
            list(x = c(2), y = c(0.35), xend = c(3),
            x_categories = structure(c(1L), class = "factor", .Label = "p")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y+0.02), label=c("p=0.67"), size = 4, inherit.aes=FALSE)

if(cp1$p.value[7]>0.05){
segdf <- structure(
            list(x = c(2), y = c(0.4), xend = c(4),
            x_categories = structure(c(1L), class = "factor", .Label = "p")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y+0.02), label=c("p=0.43"), size = 4, inherit.aes=FALSE)

if(cp1$p.value[10]>0.05){
segdf <- structure(
            list(x = c(3), y = c(0.3), xend = c(4),
            x_categories = structure(c(1L), class = "factor", .Label = "p")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y+0.02), label=c("p=0.62"), size = 4, inherit.aes=FALSE)

if(cp1$p.value[15]>0.05){
segdf <- structure(
            list(x = c(5), y = c(0.65), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "p")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y+0.02), label=c("p=0.39"), size = 4, inherit.aes=FALSE)

#######################################################################################################
cp<-compParm(fit2b, "k", "/", display=T)
cp<-data.frame(cp)

if(cp$p.value[4]<0.05){
segdf <- structure(
            list(x = c(1), y = c(0.73), xend = c(5),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("*"), size = 8, inherit.aes=FALSE)

if(cp$p.value[5]<0.05){
segdf <- structure(
            list(x = c(1), y = c(0.76), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("***"), size = 8, inherit.aes=FALSE)

if(cp$p.value[9]<0.05){
segdf <- structure(
            list(x = c(2), y = c(0.7), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("**"), size = 8, inherit.aes=FALSE)

if(cp$p.value[12]<0.05){
segdf <- structure(
            list(x = c(3), y = c(0.67), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("*"), size = 8, inherit.aes=FALSE)

if(cp$p.value[14]<0.05){
segdf <- structure(
            list(x = c(4), y = c(0.64), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("*"), size = 8, inherit.aes=FALSE)

if(cp$p.value[15]<0.05){
segdf <- structure(
            list(x = c(5), y = c(0.45), xend = c(6),
            x_categories = structure(c(1L), class = "factor", .Label = "k")), 
            .Names = c("x", "y", "xend", "Parameter"),
            row.names = c(NA, -1), class = "data.frame")
}
gg3 <- gg3 + geom_segment(data = segdf, size = .5, aes(x=x, y=y, xend=xend, yend=y), inherit.aes=FALSE) + geom_text(data = segdf, aes(x=0.5*(x+xend), y=y), label=c("**"), size = 8, inherit.aes=FALSE)


####      Fig 3  of  the  publication   ######
#cairo_pdf("Fig3.pdf", height=6, width=9)
gg3
#dev.off()
```
